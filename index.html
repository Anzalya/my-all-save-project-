<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate Mini NFS 3D</title>
<style>
body,html{margin:0;padding:0;overflow:hidden;font-family:Arial;}
canvas{display:block;}
/* Start Screen */
#start-screen{
  position:absolute;top:0;left:0;width:100%;height:100%;
  background:linear-gradient(to bottom,#1c1c1c,#0a0a0a);
  display:flex;flex-direction:column;justify-content:center;align-items:center;color:#fff;z-index:50;
  animation:fadeIn 1s;
}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
#start-screen h1{
  font-size:70px;margin-bottom:30px;text-shadow:2px 2px 12px #000;
  color:#ff4444;
}
#start-screen button{
  padding:18px 35px;font-size:26px;border:none;border-radius:12px;cursor:pointer;
  background:linear-gradient(to right,#ff0000,#ff5555);color:#fff;transition:0.3s;
}
#start-screen button:hover{background:linear-gradient(to right,#ff5555,#ff0000);transform:scale(1.05);}
.config-screen{
  position:absolute;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.85);display:flex;justify-content:center;align-items:center;
  flex-direction:column;z-index:40;color:#fff;
}
.config-screen h2{margin-bottom:15px;color:#ffbb33;}
label{margin:5px;font-size:18px;}
select,input{margin-left:5px;font-size:16px;}
.color-swatch{
  width:40px;height:40px;border-radius:8px;border:2px solid #fff;cursor:pointer;margin:5px;display:inline-block;
  transition:0.3s;
}
.color-swatch:hover{transform:scale(1.2);}
.color-swatch.selected{border-color:yellow; box-shadow:0 0 15px yellow;}
#car-options button{
  margin:5px;padding:10px 15px;border:none;border-radius:8px;cursor:pointer;
  background:#555;color:#fff;transition:0.3s;
}
#car-options button:hover{background:#777;}
#game-over{
  position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);
  color:#fff;display:none;flex-direction:column;justify-content:center;align-items:center;z-index:30;
}
button.restart-btn{
  padding:12px 25px;font-size:20px;border:none;border-radius:10px;cursor:pointer;margin-top:20px;
  background:linear-gradient(to right,#ff0000,#ff5555);color:#fff;transition:0.3s;
}
button.restart-btn:hover{background:linear-gradient(to right,#ff5555,#ff0000);transform:scale(1.05);}
</style>
</head>
<body>

<div id="start-screen">
<h1>üèéÔ∏è Ultimate Mini NFS üèéÔ∏è</h1>
<button id="begin-btn">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
</div>

<div class="config-screen" id="config-screen" style="display:none;">
<h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
<label>–°–ª–æ–∂–Ω–æ—Å—Ç—å:
<select id="difficulty">
<option value="easy">–õ–µ–≥–∫–æ</option>
<option value="normal" selected>–ù–æ—Ä–º–∞–ª—å–Ω–æ</option>
<option value="hard">–ñ—ë—Å—Ç–∫–æ</option>
</select></label>
<br>
–ú–µ—Å—Ç–æ —Å—Ç–∞—Ä—Ç–∞:<br>
<label><input type="radio" name="lane" value="left"> –õ–µ–≤–æ</label>
<label><input type="radio" name="lane" value="center" checked> –¶–µ–Ω—Ç—Ä</label>
<label><input type="radio" name="lane" value="right"> –ü—Ä–∞–≤–æ</label>
<br><br>
<h3>–¶–≤–µ—Ç –º–∞—à–∏–Ω—ã:</h3>
<div id="color-options"></div>
<br>
<h3>–ú–æ–¥–µ–ª—å –º–∞—à–∏–Ω—ã:</h3>
<div id="car-options">
<button data-car="1">–°–ø–æ—Ä—Ç–∫–∞—Ä</button>
<button data-car="2">–°–µ–¥–∞–Ω</button>
<button data-car="3">–ì–æ–Ω–æ—á–Ω–∞—è</button>
</div>
<br>
<button id="start-btn">–°—Ç–∞—Ä—Ç!</button>
</div>

<div id="game-over"><h1>You Crashed!</h1><button class="restart-btn" id="restart-btn">Restart</button></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158/build/three.min.js"></script>

<script>
// ===== VARIABLES =====
let scene,camera,renderer;
let car=null,carModelType=1;
let selectedColor="#ff0000",selectedLane="center",selectedDifficulty="normal";
let driveSpeed=0.5,enemySpeed=0.6;
let moveLeft=false,moveRight=false,isGameOver=false,userHasStarted=false;
let roadWidth=10,laneLines=[],enemyCar=null,trees=[],lamps=[];

// ===== INIT =====
function init(){
scene=new THREE.Scene();
scene.background=new THREE.Color(0x87CEEB);
scene.fog=new THREE.Fog(0x87CEEB,10,100);
camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000);
camera.position.set(0,5,15);
renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth,window.innerHeight);
document.body.appendChild(renderer.domElement);

let light=new THREE.DirectionalLight(0xffffff,1);
light.position.set(5,10,7);
scene.add(light);
scene.add(new THREE.AmbientLight(0xffffff,0.3));

createRoad(); createLaneLines(); createCar(); createEnemyCar(); createTreesAndLamps();

window.addEventListener('resize',()=>{camera.aspect=window.innerWidth/window.innerHeight;camera.updateProjectionMatrix();renderer.setSize(window.innerWidth,window.innerHeight);});
}

// ===== ROAD & LINES =====
function createRoad(){
const geom=new THREE.BoxGeometry(roadWidth,0.1,200);
const mat=new THREE.MeshStandardMaterial({color:0x333333});
const road=new THREE.Mesh(geom,mat);
road.position.z=-50;
scene.add(road);
}

function createLaneLines(){
const geom=new THREE.BoxGeometry(0.2,0.05,5);
const mat=new THREE.MeshStandardMaterial({color:0xffffff});
for(let i=-50;i<200;i+=10){
    [-roadWidth/4,0,roadWidth/4].forEach(x=>{
        let line=new THREE.Mesh(geom,mat);
        line.position.set(x,0.05,i);
        laneLines.push(line);
        scene.add(line);
    });
}}

function updateLaneLines(){
laneLines.forEach(line=>{
    line.position.z+=driveSpeed;
    if(line.position.z>20) line.position.z=-100;
});
}

// ===== CAR =====
function createCar(){
if(car) scene.remove(car);
car=new THREE.Group();
let bodyColor=new THREE.MeshStandardMaterial({color:selectedColor});

// –û—Å–Ω–æ–≤–Ω–æ–µ —Ç–µ–ª–æ
let bodyGeom;
if(carModelType==1) bodyGeom=new THREE.BoxGeometry(1.5,0.6,3);
if(carModelType==2) bodyGeom=new THREE.BoxGeometry(1.7,0.7,3.2);
if(carModelType==3) bodyGeom=new THREE.BoxGeometry(1.4,0.5,3.5);
let body=new THREE.Mesh(bodyGeom,bodyColor); body.position.y=0.5; car.add(body);

// –ö–∞–±–∏–Ω–∞
let cabinGeom=new THREE.BoxGeometry(bodyGeom.parameters.width*0.6,bodyGeom.parameters.height*0.6,bodyGeom.parameters.depth*0.6);
let cabin=new THREE.Mesh(cabinGeom,new THREE.MeshStandardMaterial({color:0x333333}));
cabin.position.y=0.8; cabin.position.z=0.1; car.add(cabin);

// –ö–æ–ª—ë—Å–∞
const wheelGeom=new THREE.CylinderGeometry(0.25,0.25,0.2,16);
const wheelMat=new THREE.MeshStandardMaterial({color:0x111111});
const positions=[[0.6,-0.25,1.2],[-0.6,-0.25,1.2],[0.6,-0.25,-1.2],[-0.6,-0.25,-1.2]];
positions.forEach(p=>{
    let w=new THREE.Mesh(wheelGeom,wheelMat);
    w.rotation.z=Math.PI/2; w.position.set(p[0],p[1],p[2]);
    car.add(w);
});

car.position.z=5; scene.add(car);
applyStartLane();
}

function applyStartLane(){if(!car)return; let laneX=0;if(selectedLane==='left') laneX=-roadWidth/4;if(selectedLane==='right') laneX=roadWidth/4; car.position.x=laneX;}
function applySelectedCarColor(){if(!car)return; car.traverse(n=>{if(n.isMesh && n.material) n.material.color.set(selectedColor);});}

// ===== ENEMY =====
function createEnemyCar(){
const geom=new THREE.BoxGeometry(1,1,2);
const mat=new THREE.MeshStandardMaterial({color:0xff0000});
enemyCar=new THREE.Mesh(geom,mat);
enemyCar.position.set(0,0.5,-30);
scene.add(enemyCar);
}
function updateEnemyCar(){
enemyCar.position.z+=enemySpeed;
if(enemyCar.position.z>10){enemyCar.position.z=-(Math.random()*80+20);enemyCar.position.x=(Math.random()*6)-3;}
}

// ===== TREES & LAMPS =====
function createTreesAndLamps(){
for(let i=-50;i<200;i+=20){
let tree=new THREE.Mesh(new THREE.ConeGeometry(1,4,8),new THREE.MeshStandardMaterial({color:0x228B22}));
tree.position.set(-roadWidth/2-2,2,i); scene.add(tree); trees.push(tree);
let tree2=tree.clone(); tree2.position.x=roadWidth/2+2; scene.add(tree2); trees.push(tree2);
let lamp=new THREE.Mesh(new THREE.CylinderGeometry(0.1,0.1,5),new THREE.MeshStandardMaterial({color:0xaaaaaa}));
lamp.position.set(-roadWidth/2-4,2.5,i); scene.add(lamp); lamps.push(lamp);
let lamp2=lamp.clone(); lamp2.position.x=roadWidth/2+4; scene.add(lamp2); lamps.push(lamp2);
}}
function updateObjects(){
trees.forEach(t=>{t.position.z+=driveSpeed;if(t.position.z>20) t.position.z-=200;});
lamps.forEach(l=>{l.position.z+=driveSpeed;if(l.position.z>20) l.position.z-=200;});
}

// ===== COLLISIONS =====
function checkCollisions(){
if(!car)return;
const c=car.position,e=enemyCar.position;
if(Math.abs(c.x-e.x)<1 && Math.abs(c.z-e.z)<2) endGame();
}
function endGame(){isGameOver=true;document.getElementById('game-over').style.display='flex';}
function restartGame(){document.getElementById('game-over').style.display='none';isGameOver=false;userHasStarted=false;document.getElementById('config-screen').style.display='flex';if(car) car.position.set(0,0,5); enemyCar.position.set(0,0.5,-30);}

// ===== UI =====
function createUI(){
const colors=["#ff0000","#00ff00","#0000ff","#ffff00","#00ffff","#ff00ff","#ffffff"];
const colorOptions=document.getElementById('color-options');
colors.forEach(hex=>{const sw=document.createElement('div'); sw.className='color-swatch'; sw.style.background=hex;
sw.addEventListener('click',()=>{selectedColor=hex; document.querySelectorAll('.color-swatch').forEach(s=>s.classList.remove('selected')); sw.classList.add('selected'); applySelectedCarColor();}); colorOptions.appendChild(sw);});

document.querySelectorAll('#car-options button').forEach(btn=>{btn.addEventListener('click',()=>{carModelType=parseInt(btn.dataset.car); createCar(); applySelectedCarColor();});});

document.getElementById('start-btn').addEventListener('click',()=>{
selectedDifficulty=document.getElementById('difficulty').value;
document.querySelectorAll('input[name="lane"]').forEach(r=>{if(r.checked)selectedLane=r.value});
applyDifficulty(); applyStartLane();
document.getElementById('config-screen').style.display='none'; userHasStarted=true; animate();
});
document.getElementById('restart-btn').addEventListener('click',restartGame);
}
function applyDifficulty(){if(selectedDifficulty==='easy') driveSpeed=0.35; if(selectedDifficulty==='normal') driveSpeed=0.5; if(selectedDifficulty==='hard') driveSpeed=0.75;}

// ===== ANIMATE =====
function animate(){
if(!userHasStarted||isGameOver) return;
requestAnimationFrame(animate);
if(car){if(moveLeft) car.position.x-=0.15;if(moveRight) car.position.x+=0.15;camera.position.x=car.position.x;}
updateLaneLines(); updateEnemyCar(); updateObjects(); checkCollisions();
renderer.render(scene,camera);
}

// ===== KEYBOARD =====
document.addEventListener('keydown',e=>{if(e.key==='ArrowLeft') moveLeft=true;if(e.key==='ArrowRight') moveRight=true;});
document.addEventListener('keyup',e=>{if(e.key==='ArrowLeft') moveLeft=false;if(e.key==='ArrowRight') moveRight=false;});

// ===== START SCREEN =====
document.getElementById('begin-btn').addEventListener('click',()=>{
document.getElementById('start-screen').style.display='none';
document.getElementById('config-screen').style.display='flex';
init(); createUI();
});
</script>
</body>
</html>
